from __future__ import annotations

from typing import Dict

from .language import DEFAULT_LANGUAGE

TRANSLATIONS: Dict[str, Dict[str, str]] = {
    "en": {
        "app_name": "MySecurity Academy",
        "welcome_title": "Welcome to MySecurity Academy",
        "welcome_message": "Learn modern cryptography through theory and practice.",
        "register": "Register",
        "login": "Log In",
        "logout": "Log Out",
        "username": "Username",
        "password": "Password",
        "password_confirm": "Confirm password",
        "new_password": "New password",
        "old_password": "Current password",
        "encryption_algorithm": "Encryption algorithm",
        "encryption_key": "Encryption key",
        "optional_key": "Optional",
        "register_action": "Create account",
        "login_action": "Sign in",
        "dashboard_title": "Learning dashboard",
        "dashboard_description": "Choose what you want to explore today.",
        "theory": "Theory",
        "tests": "Tests",
        "admin_panel": "Admin",
        "language": "Language",
        "no_theory": "No theory materials yet.",
        "no_tests": "No tests available yet.",
        "view": "Open",
        "add_theory": "Add theory",
        "add_test": "Add test",
        "add_question": "Add question",
        "title": "Title",
        "content": "Content",
        "description": "Description",
        "language_label": "Language",
        "create": "Create",
        "select_test": "Select test",
        "question": "Question",
        "options": "Options",
        "options_hint": "Separate options with a semicolon",
        "correct_option_index": "Index of the correct option (starting from 1)",
        "submit": "Submit",
        "score_message": "You scored {score} out of {total}.",
        "admin_only": "Administrator privileges required.",
        "test_created": "Test created successfully.",
        "test_updated": "Test updated successfully.",
        "question_created": "Question added successfully.",
        "theory_created": "Theory material created successfully.",
        "theory_updated": "Theory updated successfully.",
        "theory_overview_hint": "Review and update every published theory in one place.",
        "theory_form_hint": "Provide a clear title and the full body of the theory.",
        "back_to_list": "Back to list",
        "invalid_credentials": "Invalid credentials.",
        "invalid_key": "The provided encryption key is not valid for the selected algorithm.",
        "user_exists": "User with this name already exists.",
        "password_mismatch": "Passwords do not match.",
        "invalid_old_password": "The current password is incorrect.",
        "password_changed": "Password updated successfully.",
        "choose_language": "Choose language",
        "algorithm_hint": "Algorithm hint",
        "encryption_section_title": "Pick an algorithm to protect your password",
        "theory_created_at": "Published",
        "created_at": "Created",
        "welcome_dashboard": "Welcome, {username}!",
        "register_admin_notice": "The first registered user becomes an administrator.",
        "encryption_key_optional_notice": "Some algorithms do not require a key. Check the hint before submitting.",
        "user_blocked": "This account is blocked.",
        "password_change_required": "Please update your password to meet the new requirements.",
        "change_password": "Change password",
        "password_policy_hint": "Password requirement",
        "add_user": "Create user",
        "user_management": "User management",
        "manage_theories": "Edit theory",
        "manage_tests": "Edit tests",
        "manage_users": "Manage users",
        "edit": "Edit",
        "save_changes": "Save changes",
        "search_users": "Search users",
        "search_users_placeholder": "Start typing a username",
        "no_items": "Nothing to display yet.",
        "no_questions_yet": "This test has no questions yet.",
        "status": "Status",
        "password_policy": "Password policy",
        "actions": "Actions",
        "status_blocked": "Blocked",
        "status_active": "Active",
        "status_password_change_required": "Password update required",
        "block_user": "Block",
        "unblock_user": "Unblock",
        "apply_policy": "Apply",
        "password_policy_none": "No restriction",
        "user_created": "User {username} created.",
        "cannot_block_self": "You cannot change your own block status.",
        "user_blocked_admin": "User {username} has been blocked.",
        "user_unblocked_admin": "User {username} has been unblocked.",
        "password_policy_updated": "Password policy assigned to {username}.",
        "password_policy_cleared": "Password policy removed for {username}.",
        "password_policy_digits_ops_digits": "Digits, arithmetic sign, digits (e.g. 12+34)",
        "password_policy_error_digits_ops_digits": "Password must follow the pattern digits-operator-digits.",
        "password_policy_not_username": "Password must differ from the username",
        "password_policy_error_not_username": "Password must not match the username.",
        "password_policy_not_username_reversed": "Password must differ from the reversed username",
        "password_policy_error_not_username_reversed": "Password must not match the reversed username.",
        "password_policy_latin_case_digits_cyrillic": "Include Latin lower/upper letters, digits, and Cyrillic symbols",
        "password_policy_error_latin_case_digits_cyrillic": "Include lowercase and uppercase Latin letters, digits, and Cyrillic characters.",
        "password_policy_letters_digits_ops": "Include lower/upper letters, digits, and arithmetic signs",
        "password_policy_error_letters_digits_ops": "Include lowercase and uppercase letters, digits, and arithmetic operators.",
        "tests_overview_hint": "Browse tests, manage questions, and adjust their descriptions.",
        "tests_form_hint": "Describe the test and build its questions before saving.",
        "question_builder_hint": "Add at least two options and mark the correct one.",
        "question_prompt": "Question text",
        "add_option": "Add option",
        "remove_option": "Remove option",
        "remove_question": "Remove question",
        "add_new_question": "Add question to test",
        "add_another_question": "Add another question",
        "mark_as_correct": "Correct answer",
        "users_overview_hint": "Search and manage registered users.",
        "users_form_hint": "Create a new account and configure encryption settings.",
        "questions_added": "New questions added.",
        "question_removed": "Question removed.",
        "builder_prompt_required": "Enter a question text.",
        "builder_options_required": "Provide at least two answer options without empty values.",
        "builder_correct_required": "Mark the correct answer.",
        "builder_questions_required": "Add at least one question before saving.",
    },
    "ru": {
        "app_name": "Академия MySecurity",
        "welcome_title": "Добро пожаловать в Академию MySecurity",
        "welcome_message": "Изучайте современную криптографию через теорию и практику.",
        "register": "Регистрация",
        "login": "Вход",
        "logout": "Выход",
        "username": "Имя пользователя",
        "password": "Пароль",
        "password_confirm": "Подтвердите пароль",
        "new_password": "Новый пароль",
        "old_password": "Текущий пароль",
        "encryption_algorithm": "Алгоритм шифрования",
        "encryption_key": "Ключ шифрования",
        "optional_key": "Необязательно",
        "register_action": "Создать аккаунт",
        "login_action": "Войти",
        "dashboard_title": "Учебная панель",
        "dashboard_description": "Выберите, что хотите изучить сегодня.",
        "theory": "Теория",
        "tests": "Тесты",
        "admin_panel": "Админ",
        "language": "Язык",
        "no_theory": "Теоретических материалов пока нет.",
        "no_tests": "Тестов пока нет.",
        "view": "Открыть",
        "add_theory": "Добавить теорию",
        "add_test": "Добавить тест",
        "add_question": "Добавить вопрос",
        "title": "Название",
        "content": "Содержание",
        "description": "Описание",
        "language_label": "Язык",
        "create": "Создать",
        "select_test": "Выберите тест",
        "question": "Вопрос",
        "options": "Варианты ответов",
        "options_hint": "Разделяйте варианты точкой с запятой",
        "correct_option_index": "Номер правильного варианта (начиная с 1)",
        "submit": "Отправить",
        "score_message": "Вы набрали {score} из {total}.",
        "admin_only": "Требуются права администратора.",
        "test_created": "Тест успешно создан.",
        "test_updated": "Тест обновлен.",
        "question_created": "Вопрос успешно добавлен.",
        "theory_created": "Теория успешно добавлена.",
        "theory_updated": "Теория обновлена.",
        "theory_overview_hint": "Полный список опубликованных теорий для редактирования.",
        "theory_form_hint": "Укажите понятное название и полное содержание материала.",
        "back_to_list": "Вернуться к списку",
        "invalid_credentials": "Неверные учетные данные.",
        "invalid_key": "Введен недопустимый ключ для выбранного алгоритма.",
        "user_exists": "Пользователь с таким именем уже существует.",
        "password_mismatch": "Пароли не совпадают.",
        "invalid_old_password": "Текущий пароль введен неверно.",
        "password_changed": "Пароль успешно обновлен.",
        "choose_language": "Выберите язык",
        "algorithm_hint": "Подсказка к алгоритму",
        "encryption_section_title": "Выберите алгоритм защиты пароля",
        "theory_created_at": "Опубликовано",
        "created_at": "Создан",
        "welcome_dashboard": "Добро пожаловать, {username}!",
        "register_admin_notice": "Первый зарегистрированный пользователь становится администратором.",
        "encryption_key_optional_notice": "Некоторым алгоритмам не нужен ключ. Смотрите подсказку перед отправкой.",
        "user_blocked": "Этот аккаунт заблокирован.",
        "password_change_required": "Пожалуйста, обновите пароль в соответствии с новыми требованиями.",
        "change_password": "Сменить пароль",
        "password_policy_hint": "Требование к паролю",
        "add_user": "Создать пользователя",
        "user_management": "Управление пользователями",
        "manage_theories": "Редактировать теорию",
        "manage_tests": "Редактировать тесты",
        "manage_users": "Управление пользователями",
        "edit": "Редактировать",
        "save_changes": "Сохранить",
        "search_users": "Поиск пользователей",
        "search_users_placeholder": "Начните вводить имя пользователя",
        "no_items": "Пока нечего отображать.",
        "no_questions_yet": "В этом тесте пока нет вопросов.",
        "status": "Статус",
        "password_policy": "Политика пароля",
        "actions": "Действия",
        "status_blocked": "Заблокирован",
        "status_active": "Активен",
        "status_password_change_required": "Требуется смена пароля",
        "block_user": "Заблокировать",
        "unblock_user": "Разблокировать",
        "apply_policy": "Применить",
        "password_policy_none": "Без ограничения",
        "user_created": "Пользователь {username} создан.",
        "cannot_block_self": "Нельзя изменить собственный статус блокировки.",
        "user_blocked_admin": "Пользователь {username} заблокирован.",
        "user_unblocked_admin": "Пользователь {username} разблокирован.",
        "password_policy_updated": "Для {username} назначены новые требования к паролю.",
        "password_policy_cleared": "Требования к паролю для {username} сняты.",
        "password_policy_digits_ops_digits": "Цифры, знак операции и снова цифры (например, 12+34)",
        "password_policy_error_digits_ops_digits": "Пароль должен соответствовать шаблону цифры-знак-цифры.",
        "password_policy_not_username": "Пароль не должен совпадать с именем пользователя",
        "password_policy_error_not_username": "Пароль не должен совпадать с именем пользователя.",
        "password_policy_not_username_reversed": "Пароль не должен совпадать с именем пользователя наоборот",
        "password_policy_error_not_username_reversed": "Пароль не должен совпадать с именем пользователя, записанным наоборот.",
        "password_policy_latin_case_digits_cyrillic": "Использовать латинские строчные/прописные буквы, цифры и кириллицу",
        "password_policy_error_latin_case_digits_cyrillic": "Добавьте строчные и прописные латинские буквы, цифры и символы кириллицы.",
        "password_policy_letters_digits_ops": "Использовать строчные/прописные буквы, цифры и знаки операций",
        "password_policy_error_letters_digits_ops": "Добавьте строчные и прописные буквы, цифры и знаки арифметических операций.",
        "tests_overview_hint": "Просматривайте тесты, редактируйте описание и вопросы.",
        "tests_form_hint": "Опишите тест и создайте вопросы перед сохранением.",
        "question_builder_hint": "Добавьте минимум два варианта ответа и отметьте правильный.",
        "question_prompt": "Текст вопроса",
        "add_option": "Добавить вариант",
        "remove_option": "Удалить вариант",
        "remove_question": "Удалить вопрос",
        "add_new_question": "Добавить вопрос в тест",
        "add_another_question": "Добавить еще вопрос",
        "mark_as_correct": "Правильный ответ",
        "users_overview_hint": "Ищите и управляйте зарегистрированными пользователями.",
        "users_form_hint": "Создайте новую учетную запись и настройте шифрование.",
        "questions_added": "Новые вопросы добавлены.",
        "question_removed": "Вопрос удален.",
        "builder_prompt_required": "Введите текст вопроса.",
        "builder_options_required": "Добавьте как минимум два варианта без пустых значений.",
        "builder_correct_required": "Отметьте правильный вариант.",
        "builder_questions_required": "Добавьте хотя бы один вопрос перед сохранением.",
    },
}


LANGUAGE_NAMES = {
    "en": "English",
    "ru": "Русский",
}


def translate(key: str, language: str | None = None) -> str:
    lang = language or DEFAULT_LANGUAGE
    bundle = TRANSLATIONS.get(lang, TRANSLATIONS[DEFAULT_LANGUAGE])
    return bundle.get(key, TRANSLATIONS[DEFAULT_LANGUAGE].get(key, key))


def get_translation_bundle(language: str | None = None) -> Dict[str, str]:
    lang = language or DEFAULT_LANGUAGE
    return TRANSLATIONS.get(lang, TRANSLATIONS[DEFAULT_LANGUAGE])
